<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Sistema de Produtos</title>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .login-container {
        background: white;
        padding: 50px;
        border-radius: 20px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .login-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .login-header h1 {
        font-size: 32px;
        color: #667eea;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .login-header p {
        color: #888;
        font-size: 15px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
    }

    input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: 0.3s;
        font-family: inherit;
    }

    input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    input::placeholder {
        color: #bbb;
    }

    .login-button {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
    }

    .login-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .login-button:active {
        transform: translateY(0);
    }

    .error-message {
        background: #ffebee;
        color: #c62828;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 20px;
        display: none;
        border-left: 4px solid #f44336;
    }

    .demo-credentials {
        background: #f5f7ff;
        padding: 15px;
        border-radius: 10px;
        margin-top: 30px;
        border-left: 4px solid #667eea;
        font-size: 13px;
        color: #666;
    }

    .demo-credentials h3 {
        color: #667eea;
        font-size: 13px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .demo-credentials p {
        margin: 5px 0;
        font-family: 'Courier New', monospace;
    }

    .demo-credentials strong {
        color: #333;
    }
</style>

</head>
<body>

<div class="login-container">

    <div class="login-header">
        <h1>üîê Sistema de Produtos</h1>
        <p>Fa√ßa login para continuar</p>
    </div>

    <div id="msgErro" class="error-message">‚ùå Usu√°rio ou senha incorretos</div>

    <form onsubmit="logar(event)">
        <div class="form-group">
            <label for="usuario">üë§ Usu√°rio</label>
            <input 
                type="text" 
                id="usuario" 
                placeholder="Digite seu usu√°rio" 
                autocomplete="off"
                required
            >
        </div>

        <div class="form-group">
            <label for="senha">üîë Senha</label>
            <input 
                type="password" 
                id="senha" 
                placeholder="Digite sua senha"
                required
            >
        </div>

        <button type="submit" class="login-button">üì≤ Entrar</button>
    </form>

    <div class="demo-credentials">
        <h3>üìå Dados de Teste</h3>
        <p><strong>Usu√°rio:</strong> admin</p>
        <p><strong>Senha:</strong> 123</p>
    </div>

</div>

<script>
async function logar(event) {
    event.preventDefault();
    
    const usuario = document.getElementById("usuario").value.trim();
    const senha = document.getElementById("senha").value;

    console.log("üîê Tentando login com:", usuario);

    const r = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ usuario, senha })
    });

    const resp = await r.json();
    console.log("‚úÖ Resposta do servidor:", resp);

    if (resp.ok) {
        // SALVANDO NO LOCALSTORAGE
        localStorage.setItem("logado", "sim");
        localStorage.setItem("usuario", usuario);
        // Garantir que o tipo seja salvo ‚Äî usa retorno do backend quando dispon√≠vel,
        // caso contr√°rio assume 'admin' somente se o nome de usu√°rio for 'admin'.
        const tipo = resp.tipo || (usuario === 'admin' ? 'admin' : 'user');
        localStorage.setItem("tipo", tipo);

        console.log("üíæ localStorage ap√≥s login:", {
            logado: localStorage.getItem("logado"),
            usuario: localStorage.getItem("usuario"),
            tipo: localStorage.getItem("tipo")
        });

        // REDIRECIONA PARA A HOME
        console.log("üöÄ Redirecionando para /home.html");
        window.location.href = "/home.html";
    } else {
        console.error("‚ùå Login falhou:", resp);
        document.getElementById("msgErro").style.display = "block";
        
        // Limpar a senha por seguran√ßa
        document.getElementById("senha").value = "";
        document.getElementById("usuario").focus();
    }
}

// Permitir Enter para enviar
document.getElementById("usuario").addEventListener("keypress", (e) => {
    if (e.key === "Enter") document.getElementById("senha").focus();
});

document.getElementById("senha").addEventListener("keypress", (e) => {
    if (e.key === "Enter") document.querySelector("form").dispatchEvent(new Event("submit"));
});
</script>

</body>
</html>
